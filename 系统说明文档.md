# 双端记账系统 - 系统说明文档

## 项目概述

这是一个完整的双端记账系统，支持Web端和移动端数据互通，多用户登录。系统采用现代化的前后端分离架构，提供完整的财务记录管理、数据统计分析和实时数据同步功能。

## 系统架构

### 技术栈

**后端服务:**
- Python Flask
- SQLite数据库
- RESTful API设计
- 数据同步机制

**Web端:**
- Flask模板引擎
- HTML5/CSS3/JavaScript
- ECharts数据可视化
- 响应式设计

**移动端:**
- React Native
- React Native Paper UI组件库
- AsyncStorage本地存储
- 图表可视化

### 系统架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   移动端应用     │    │   后端API服务    │    │   Web端应用     │
│                 │    │                 │    │                 │
│ React Native    │◄──►│ Python Flask    │◄──►│ Flask + HTML   │
│ AsyncStorage    │    │ SQLite          │    │ ECharts         │
│ 数据同步        │    │ 数据同步API      │    │ 响应式设计      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 功能特性

### 核心功能

1. **多用户系统**
   - 用户注册和登录
   - 密码哈希加密
   - 独立数据存储

2. **财务记录管理**
   - 收入和支出记录
   - 预设分类管理
   - 记录增删改查

3. **数据统计分析**
   - 实时收支统计
   - 月度趋势图表
   - 分类分析饼图

4. **双端数据同步**
   - 实时数据同步
   - 冲突解决机制
   - 自动同步功能

### 特色功能

- **实时同步**: Web端和移动端数据实时同步
- **可视化分析**: 专业的图表展示和数据洞察
- **响应式设计**: 适配桌面和移动设备
- **数据安全**: 密码加密和用户隔离
- **离线支持**: 移动端支持离线操作

## 安装和部署

### 环境要求

- Python 3.7+
- Node.js (移动端开发)
- React Native环境

### 安装步骤

1. **安装Python依赖**
   ```bash
   pip install flask flask_cors requests
   ```

2. **启动系统**
   ```bash
   cd Finance
   python start_system.py
   ```

3. **移动端部署**
   ```bash
   cd mobile_finance_app
   npm install
   # 根据React Native文档进行构建
   ```

### 系统启动

系统提供一键启动脚本：
```bash
python start_system.py
```

启动后访问：
- Web端: http://127.0.0.1:5000
- API服务: http://127.0.0.1:5001

## 使用指南

### 首次使用

1. **注册账户**
   - 访问Web端注册页面
   - 创建用户名和密码
   - 系统自动生成同步令牌

2. **Web端使用**
   - 登录后进入仪表板
   - 添加收入和支出记录
   - 查看统计图表和趋势

3. **移动端配置**
   - 安装移动端应用
   - 在设置中输入同步令牌
   - 开始使用移动端记账

### 数据同步

1. **自动同步**
   - Web端每30秒自动同步
   - 移动端每60秒自动同步
   - 记录操作后立即同步

2. **手动同步**
   - Web端: 页面加载时自动同步
   - 移动端: 点击同步按钮

3. **同步令牌**
   - 每个用户有唯一同步令牌
   - 用于设备身份验证
   - 可在Web端登录后获取

## API文档

### 认证API

- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `GET /api/auth/status` - 认证状态

### 记录管理API

- `GET /api/records` - 获取记录列表
- `POST /api/records` - 添加新记录
- `DELETE /api/records/{id}` - 删除记录

### 数据统计API

- `GET /api/summary` - 获取汇总数据
- `GET /api/monthly-data` - 获取月度数据
- `GET /api/categories` - 获取分类列表

### 同步API

- `POST /api/sync` - 数据同步
- `GET /api/sync/records` - 获取同步记录

## 数据库设计

### 用户表 (users)
- id: 主键
- username: 用户名
- password_hash: 密码哈希
- email: 邮箱
- created_at: 创建时间
- last_login: 最后登录时间
- sync_token: 同步令牌

### 财务记录表 (finance_records)
- id: 主键
- user_id: 用户ID
- amount: 金额
- category: 分类
- record_type: 类型(income/expense)
- description: 描述
- record_date: 记录日期
- created_at: 创建时间
- updated_at: 更新时间
- sync_id: 同步ID

### 同步记录表 (sync_records)
- id: 主键
- user_id: 用户ID
- device_id: 设备ID
- last_sync_time: 最后同步时间
- sync_count: 同步次数

## 移动端配置

### 环境要求
- React Native 0.70+
- React Native Paper
- React Native Chart Kit
- AsyncStorage

### 安装依赖
```bash
cd mobile_finance_app
npm install
```

### 构建和运行
```bash
# Android
npx react-native run-android

# iOS
npx react-native run-ios
```

## 故障排除

### 常见问题

1. **同步失败**
   - 检查网络连接
   - 验证同步令牌
   - 确认后端服务运行

2. **数据不一致**
   - 手动触发同步
   - 检查设备时间设置
   - 查看同步日志

3. **性能问题**
   - 减少自动同步频率
   - 优化数据库查询
   - 清理历史数据

### 日志查看

- Web端: 浏览器开发者工具
- 后端: 控制台输出
- 移动端: React Native调试工具

## 扩展开发

### 添加新功能

1. **新分类**
   - 在FinanceManager中更新categories
   - 更新前端分类选项

2. **新图表**
   - 添加新的API端点
   - 在前端实现图表组件

3. **新同步策略**
   - 修改SyncManager逻辑
   - 更新客户端同步代码

### 部署建议

1. **生产环境**
   - 使用生产级Web服务器
   - 配置HTTPS
   - 数据库备份策略

2. **性能优化**
   - 数据库索引优化
   - API响应缓存
   - 前端资源压缩

## 许可证

MIT License

## 技术支持

如有问题请联系开发团队或查看项目文档。
